<div class="w-full py-2 px-2 sm:py-3 sm:px-3">
    <div class="group">
        <!-- Product Card - sized to image -->
        <div class="border border-gray-200 rounded-lg overflow-hidden group shadow-sm hover:shadow-md transition-shadow duration-300">
            <a href="{{ product.url }}">
                {% if product.media.size > 1 %}
                    <div class="h-40 sm:h-60 md:h-80 overflow-hidden relative">
                        <img class="w-full h-full object-cover transition duration-1000 ease-in-out group-hover:opacity-0 absolute inset-0" src="{{ product.media.first | img_url: 'medium' }}" alt="{{ product.media.first.preview_image.alt }}">
                        <img class="w-full h-full object-cover transition duration-1000 ease-in-out opacity-0 group-hover:opacity-100 hover:scale-105 absolute inset-0" src="{{ product.media[1] | img_url: 'medium' }}" alt="{{ product.media[1].preview_image.alt }}">
                    </div>
                {% elsif product.featured_image %}
                    <div class="h-40 sm:h-60 md:h-80 overflow-hidden relative">
                        <img class="w-full h-full object-cover transition duration-1000 ease-in-out hover:scale-105 transform" src="{{ product.featured_image | img_url: 'medium' }}" alt="{{ product.featured_image.alt }}">
                    </div>
                {% else %}
                    {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover bg-gray-100' }}
                {% endif %}
            </a>
        </div>
        
        <!-- Product Info - always visible outside the card -->
        <div class="flex flex-col p-4" id="product-card-info">
            <a class="text-gray-700 uppercase font-medium text-center whitespace-nowrap overflow-hidden text-ellipsis" href="{{ product.url }}">
                {{ product.title | truncatewords: 4 }}
            </a>
            
            <p class="text-gray-500 font-bold text-center mt-2">
                {{ product.price | money }}
            </p>

            <form action="/cart/add" method="post" class="add-to-cart-form">
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                
                <div class="flex justify-center mt-4">
                    <div class="h-10 w-1/2 bg-black rounded-lg transition-transform duration-300 hover:scale-105">
                        <button type="submit" class="relative uppercase text-sm bg-[#ffb045] text-black border-[0.5px] border-black rounded-lg font-bold py-2 px-1 w-full add-to-cart hover:bg-[#ff9f2a] transition-colors duration-300">
                            Add to cart
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Select all forms that add items to the cart
        const cartForms = document.querySelectorAll('form[action="/cart/add"]');

        cartForms.forEach(function(form) {
            form.addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent default form submission

                const formData = new FormData(form);

                // Get the variant ID and quantity from the form data
                const variantId = formData.get('id');
                const quantity = formData.get('quantity') || 1; // Default to 1 if not specified

                // Disable the submit button to prevent multiple clicks
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerText = "Adding...";

                // Use fetch to add the item to the cart
                fetch('/cart/add.js', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        id: variantId,
                        quantity: quantity
                    })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Item added to cart:', data);
                    // Optionally update the cart UI or show a confirmation message
                })
                .catch(error => {
                    console.error('Error adding item to cart:', error);
                })
                .finally(() => {
                    // Re-enable the button after the request is complete
                    submitButton.disabled = false;
                    submitButton.innerText = "Add to cart";
                });
            });
        });
    });
</script>